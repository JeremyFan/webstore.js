<html>
<head>
    <title>Test Result</title>
    <basefont face="Tahoma" size="2" />
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta name="exporter-version" content="Evernote Windows/269392 (zh-CN); Windows/6.2.9200;" />
    <style>
        html { font: 14px Tahoma,Helvetica,Arial; }
        .title { padding: 15px; background: #eee; }
        body, td {
            font-family: Tahoma;
            font-size: 11pt;
        }
    </style>
</head>
<body>
    <a name="11819" />
    <p class='title'>
        这个页面比较乱（直接从Evernote导出的），是乱七八糟的测试结果。
    </p>
    <div>
        <div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;">
            <div style="font-size: 19px;"><b>文件</b></div>
            <div>
                <br clear="none">
            </div>
            <div>1. webstore.js 封装好的js</div>
            <div>2. demo1.html 检测浏览器使用哪种get, set方法</div>
            <div>3. demo2.html 实例。使用webstore.js实现Web本地存储</div>
            <div>4. test.html 存储量测试</div>
            <div>5. test_result.html Evernot导出的测试结果</div>
            <div>
                <br clear="none">
            </div>
            <div style="font-size: 19px;"><b>测试环境</b></div>
            <div>
                <br clear="none">
            </div>
            <div>win（win7）下：</div>
            <div>
                <br clear="none">
            </div>
            <div>IE10以及IE10的IE7/IE8/IE9模式</div>
            <div>Chrome 31.0.1650.57 m</div>
            <div>FireFox 25.0.1</div>
            <div>Safari 5.7.1</div>
            <div>Opera 17.0.1241.45</div>
            <div>
                <br clear="none">
            </div>
            <div>以及xp虚拟机下的IE6</div>
            <div>
                <br clear="none">
            </div>
            <div>win（win8）下：</div>
            <div>
                <br clear="none">
            </div>
            <div>IE10</div>
            <div>
                <br clear="none">
            </div>
            <div>Chrome 31.0.1650.57 m</div>
            <div>
                <br clear="none">
            </div>
            <div>FireFox 25.0.1</div>
            <div>
                <br clear="none">
            </div>
            <div>Linux（Ubuntu 13.10）下：</div>
            <div>
                <br clear="none">
            </div>
            <div>Chromium <span>29.0.1547.65</span></div>
            <div>
                <br clear="none">
            </div>
            <div>FireFox 25.0</div>
            <div></div>
            <div>
                <br>
            </div>
            <div style="font-size: 19px;"><b>demo1、demo2测试</b></div>
            <div>
                <br>
            </div>
            <div>以下是参与测试的浏览器及测试结果。demo1的结果代表浏览器使用哪种方式存储，demo2的结果表示实例中的数据能否正常存储。</div>
            <div></div>
            <table border="1" cellpadding="2" cellspacing="0" style="text-align: center;" width="500">
                <tbody>
                    <tr>
                        <td valign="top">浏览器</td>
                        <td valign="top">demo1</td>
                        <td valign="top">demo2</td>
                    </tr>
                    <tr>
                        <td valign="top">IE10（win7）</td>
                        <td valign="top">localStorage</td>
                        <td valign="top">正常</td>
                    </tr>
                    <tr>
                        <td valign="top">IE10的IE9模式（win7）</td>
                        <td valign="top">
                            <div>localStorage</div>
                        </td>
                        <td valign="top">正常</td>
                    </tr>
                    <tr>
                        <td valign="top">
                            <div>IE10的IE8模式（win7）</div>
                        </td>
                        <td valign="top">
                            <div>localStorage</div>
                        </td>
                        <td valign="top">
                            <div>正常</div>
                        </td>
                    </tr>
                    <tr>
                        <td valign="top">
                            <div>IE10的IE7模式（win7）</div>
                        </td>
                        <td valign="top">
                            <div>localStorage</div>
                        </td>
                        <td valign="top">
                            <div>正常</div>
                        </td>
                    </tr>
                    <tr>
                        <td valign="top">IE6（win7 xp mode）</td>
                        <td valign="top">userData</td>
                        <td valign="top">正常</td>
                    </tr>
                    <tr>
                        <td valign="top">Chrome 31（win7）</td>
                        <td valign="top">localStorage</td>
                        <td valign="top">正常</td>
                    </tr>
                    <tr>
                        <td valign="top">FireFox 25（win7）</td>
                        <td valign="top">localStorage</td>
                        <td valign="top">正常</td>
                    </tr>
                    <tr>
                        <td valign="top">Safari 5（win7）</td>
                        <td valign="top">
                            <div>localStorage</div>
                        </td>
                        <td valign="top">正常</td>
                    </tr>
                    <tr>
                        <td valign="top">Opera 17（win7）</td>
                        <td valign="top">
                            <div>localStorage</div>
                        </td>
                        <td valign="top">正常</td>
                    </tr>
                    <tr>
                        <td valign="top">IE10（win8）</td>
                        <td valign="top">
                            <div>localStorage</div>
                        </td>
                        <td valign="top">正常</td>
                    </tr>
                    <tr>
                        <td valign="top">Chrome 31（win8）</td>
                        <td valign="top">
                            <div>localStorage</div>
                        </td>
                        <td valign="top">正常</td>
                    </tr>
                    <tr>
                        <td valign="top">FireFox 25（win8）</td>
                        <td valign="top">localStorage</td>
                        <td valign="top">正常</td>
                    </tr>
                    <tr>
                        <td valign="top">Chromium 29（Ubuntu 13.10）</td>
                        <td valign="top">
                            <br>
                        </td>
                        <td valign="top">
                            <br>
                        </td>
                    </tr>
                    <tr>
                        <td valign="top">FireFox 25.0（Ubuntu 13.10）</td>
                        <td valign="top">
                            <br>
                        </td>
                        <td valign="top">
                            <br>
                        </td>
                    </tr>
                </tbody>
            </table>
            <br>
            <div>值得注意的是在IE10的各种模式下都是使用localStorage存储，且相当于一个浏览器（本来就是一个-.-||），在一个模式下添加的数据在其他模式下都能看到。</div>
            <div>
                <br>
            </div>
            <div>
                <br>
            </div>
            <div style="font-size: 19px;"><b>存储量测试</b></div>
            <div>
                <br>
            </div>
            <div>首先对localStorage的存储量测试。参与测试的浏览器：win7下的Chrome31/IE10/FireFox25/Opera17</div>
            <div>
                <br>
            </div>
            <div>代码：</div>
            <div>
                <blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;">
                    <div align="left">
                        var s = 'a' ;<br>
                        $( '#test2' ).bind('click' , function () {<br>
                        //debugger;<br>
                        while (true ) {<br>
                        s += s;<br>
                        webstore.set( 'KeyA' , s);<br>
                        console.log(s.length);<br>
                        }<br>
                        });
                    </div>
                    <div align="left">
                        <br>
                    </div>
                    <div align="left">
                        <img src="test_result_files/Image.png" type="image/png" style="cursor: default; cursor: default; cursor: default; cursor: default;" /></div>
                    <div align="left">
                        <br>
                    </div>
                </blockquote>
            </div>
            <div>测试结果在chrome，ie10，ff，opera下表现一致：</div>
            <div>
                <br>
            </div>
            <div>
                <img src="test_result_files/Image [1].png" type="image/png" style="cursor: default; cursor: default; cursor: default; cursor: default;" /></div>
            <div>
                <img src="test_result_files/Image [2].png" type="image/png" style="cursor: default; cursor: default; cursor: default; cursor: default;" /></div>
            <div>
                <img src="test_result_files/Image [3].png" type="image/png" style="cursor: default; cursor: default; cursor: default; cursor: default;" /></div>
            <div>
                <img src="test_result_files/Image [4].png" type="image/png" style="cursor: default; cursor: default; cursor: default; cursor: default;" /></div>
            <div>当字符串长度是4194304时，可以存储，再次翻倍准备存储时超出容量。</div>
            <div>
                <br>
            </div>
            <div>在safari下的结果：</div>
            <div>
                <img src="test_result_files/Image [5].png" type="image/png" style="cursor: default; cursor: default; cursor: default; cursor: default;" /></div>
            <div>safari的存储上限要少一些，对于safari不能存储4194304长度的字符串。</div>
            <div></div>
            <div>以上测试结果基本和预期一致，符合localStorage是5MB/2.5MB（区分不同的浏览器）的限制。</div>
            <div>
                <br>
            </div>
            <div>“对于localStorage而言，大多数桌面浏览器会设置每个来源5MB的限制。Chrome和Safari对每个来源的限制是2.5MB。”（《JavaScript高级程序设计（第3版）》第643页）</div>
            <div>
                <br>
            </div>
            <div>Chrome的测试结果是不是2.5MB，应该是Chrome的后续更新把限制提升到了5MB。</div>
            <div>
                <br>
            </div>
            <div>
                <br>
            </div>
            <div>重点是对userData存储量的测试。（木桶定理-.-||）参与测试的浏览器win7 XP Mode下的IE6/win7下IE10的IE7模式</div>
            <div>
                <br>
            </div>
            <div>
                <br>
            </div>
            <div>&lt;i&gt;测试IE7下userData的存储量</div>
            <div>
                <br>
            </div>
            <div>代码：</div>
            <div>
                <div>
                    <div>// userData测试（ie7）</div>
                    var s = '';<br>
                    var a = 'aaaaaaaaaa';<br>
                    $('#test2').bind('click', function () {<br>
                    while (true) {<br>
                    s += a;<br>
                    webstore.set('KeyA', s);<br>
                    console.log(webstore.get('KeyA').length);<br>
                    }<br>
                    });
                </div>
                <div>
                    <br>
                </div>
                <div>
                    <img src="test_result_files/Image [6].png" type="image/png" style="cursor: default;" /></div>
                <div>
                    <br>
                </div>
                <div>这里对IE7的测试是在IE10的IE7模式下实现的。修改了判断的逻辑，强制使用userData存储。</div>
                <div>
                    <br>
                </div>
                <div>测试结果：</div>
                <br>
            </div>
            <div>
                <br>
            </div>
            <div>&lt;ii&gt;测试IE6下userData的存储量</div>
            <div>
                <br>
            </div>
            <div>代码：</div>
            <div>// userData测试（ie6）</div>
            var s = 'aaa';<br>
            var a = 'aaaaaaaaaa';<br>
            $('#test2').bind('click', function () {<br>
            while (true) {<br>
            s += s;<br>
            webstore.set('KeyA', s);<br>
            alert(webstore.get('KeyA').length);<br>
            }<br>
            });
            <div>
                <br>
            </div>
            <div>
                <img src="test_result_files/Image [7].png" type="image/png" style="cursor: default; cursor: default; cursor: default; cursor: default;" /></div>
            <div>
                <br>
            </div>
            <div>
                IE6的debugbar不支持console，所以直接用alert支持输出长度。测了两组（s的初始值分别为'aa'和'aaa'），最终的结果是：
                <div>
                    <br>
                </div>
                <div>
                    <img src="test_result_files/Image [8].png" type="image/png" style="cursor: default; cursor: default; cursor: default; cursor: default;" /></div>
                <div>
                    <img src="test_result_files/Image [9].png" type="image/png" style="cursor: default; cursor: default; cursor: default; cursor: default;" /></div>
                <div>可以看出IE6对于存储的限制应当也是64k。</div>
                <div>
                    <br>
                </div>
                <div>
                    <br>
                </div>
                <div>综上对于两种存储方法的测试结果基本符合预期。（因为之前测试的失误，还以为userData的存储量与存储与是否存储在一个空间有关系，应该是因为浏览器缓存问题没有测准。）</div>
                <div>
                    <br>
                </div>
            </div>
            <div></div>
            <div><span style="font-size: 19px;"><b>跨页面测试</b></span></div>
            <div>
                <br>
            </div>
            <div>+++     </div>
            <div>
                <br>
                <div>
                    <br clear="none">
                </div>
                <div>剩余问题：</div>
                <div>
                    <br clear="none">
                </div>
                <div>1. 除set(), get()外是否还需要其他的方法</div>
                <div>2. 目前是存字符串，是否需要集成json转换，直接存取对象</div>
                <div>3. 跨目录问题。</div>
                <div>4. 实际应用中可能遇到的没有考虑到的问题</div>
            </div>
        </div>
    </div>
</body>
</html>